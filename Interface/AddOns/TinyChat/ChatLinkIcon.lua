--------------------------------------- 聊天記錄的超鏈接前增加icon顯示-- 物品 法術 成就-- Author:M-------------------------------------local function filter(self, event, msg, ...)    if (not TinyChatDB or not TinyChatDB.hideLinkIcon) then        msg = msg:gsub("|H([^:|]+):(%d+):([^|]-)|h(.-)|h", function(schema, id, extra, name)            local texture            if (schema == "item") then                local iname, _, _, ilevel, _, _, _, _, _, itexture = GetItemInfo(id)                if (ilevel) then                    name = "[" .. ilevel .. ":" .. iname .. "]"                end                texture = itexture            elseif (schema == "spell") then                texture = select(3, GetSpellInfo(id))            elseif (schema == "achievement") then                texture = select(10, GetAchievementInfo(id))            end            if (texture) then                return "|HChatLinkIcon|h|T"..texture..":0|t|h" .. "|H" .. schema .. ":" .. id .. ":" .. extra .. "|h" .. name .. "|h"            else                return "|H" .. schema .. ":" .. id .. ":" .. extra .. "|h" .. name .. "|h"            end        end)    end    return false, msg, ...enddo    --創建大圖標框体    local bigIconFrame = CreateFrame("Frame", nil, UIParent)    bigIconFrame:SetSize(48, 48)    bigIconFrame:SetFrameStrata("TOOLTIP")    bigIconFrame.icon = bigIconFrame:CreateTexture(nil , "BACKGROUND")    bigIconFrame.icon:SetSize(48, 48)    bigIconFrame.icon:SetPoint("CENTER")    bigIconFrame:Hide()    --設置鼠標懸停顯示大圖標    local function OnHyperlinkEnter(self, linkData, link)        if (linkData ~= "ChatLinkIcon") then return end        local texture = link:match("%|T(%d+):.-%|t")        if (texture) then            local cursorX, cursorY = GetCursorPosition()            bigIconFrame.icon:SetTexture(texture)            bigIconFrame:SetPoint("TOP", UIParent, "BOTTOMLEFT", cursorX / UIParent:GetScale() + 24, cursorY / UIParent:GetScale() + 10)            bigIconFrame:Show()        end    end    local function OnHyperlinkLeave(self, linkData, link)        bigIconFrame:Hide()    end    for i = 1, NUM_CHAT_WINDOWS do        _G["ChatFrame" .. i]:HookScript("OnHyperlinkEnter", OnHyperlinkEnter)        _G["ChatFrame" .. i]:HookScript("OnHyperlinkLeave", OnHyperlinkLeave)    end    --HACK    local _SetItemRef = SetItemRef    SetItemRef = function(link, text, button, chatFrame)        if (link:sub(1,12) == "ChatLinkIcon") then            return        end        _SetItemRef(link, text, button, chatFrame)    endendChatFrame_AddMessageEventFilter("CHAT_MSG_CHANNEL", filter)ChatFrame_AddMessageEventFilter("CHAT_MSG_SAY", filter)ChatFrame_AddMessageEventFilter("CHAT_MSG_YELL", filter)ChatFrame_AddMessageEventFilter("CHAT_MSG_WHISPER", filter)ChatFrame_AddMessageEventFilter("CHAT_MSG_BN_WHISPER", filter)ChatFrame_AddMessageEventFilter("CHAT_MSG_WHISPER_INFORM", filter)ChatFrame_AddMessageEventFilter("CHAT_MSG_RAID", filter)ChatFrame_AddMessageEventFilter("CHAT_MSG_RAID_LEADER", filter)ChatFrame_AddMessageEventFilter("CHAT_MSG_PARTY", filter)ChatFrame_AddMessageEventFilter("CHAT_MSG_PARTY_LEADER", filter)ChatFrame_AddMessageEventFilter("CHAT_MSG_GUILD", filter)ChatFrame_AddMessageEventFilter("CHAT_MSG_BATTLEGROUND", filter)ChatFrame_AddMessageEventFilter("CHAT_MSG_LOOT", filter)